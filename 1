This step may take considerable amount of time, please wait..
Done.
Configuring client side components
This program will set up IPA client.
Version 4.11.3

Using existing certificate '/etc/ipa/ca.crt'.
Client hostname: freeipa.seaproject-test.ru
Realm: SEAPROJECT-TEST.RU
DNS Domain: seaproject-test.ru
IPA Server: freeipa.seaproject-test.ru
BaseDN: dc=seaproject-test,dc=ru

Configured /etc/sssd/sssd.conf
cannot connect to 'https://freeipa.seaproject-test.ru/ipa/json': [SSL] record layer failure (_ssl.c:992)
The ipa-client-install command failed. See /var/log/ipaclient-install.log for more information
Configuration of client side components failed!
The ipa-server-install command failed. See /var/log/ipaserver-install.log for more information
Неудача. См. /var/log/astra-freeipa-server.log
root@freeipa:~# ping freeipa.seaproject-test.ru
curl -v https://freeipa.seaproject-test.ru/ipa/json
PING freeipa.seaproject-test.ru (10.0.2.30) 56(84) bytes of data.
64 bytes from freeipa.seaproject-test.ru (10.0.2.30): icmp_seq=1 ttl=64 time=0.057 ms
64 bytes from freeipa.seaproject-test.ru (10.0.2.30): icmp_seq=2 ttl=64 time=0.045 ms
64 bytes from freeipa.seaproject-test.ru (10.0.2.30): icmp_seq=3 ttl=64 time=0.052 ms
64 bytes from freeipa.seaproject-test.ru (10.0.2.30): icmp_seq=4 ttl=64 time=0.055 ms
^C
--- freeipa.seaproject-test.ru ping statistics ---
4 packets transmitted, 4 received, 0% packet loss, time 3058ms
rtt min/avg/max/mdev = 0.045/0.052/0.057/0.004 ms
*   Trying 10.0.2.30:443...
* Connected to freeipa.seaproject-test.ru (10.0.2.30) port 443 (#0)
* ALPN: offers h2,http/1.1
* TLSv1.3 (OUT), TLS handshake, Client hello (1):
*  CAfile: /etc/ssl/certs/ca-certificates.crt
*  CApath: /etc/ssl/certs
* TLSv1.3 (OUT), TLS alert, record overflow (534):
* OpenSSL/3.4.0: error:0A0000C6:SSL routines::packet length too long
* Closing connection 0
curl: (35) OpenSSL/3.4.0: error:0A0000C6:SSL routines::packet length too long


root@freeipa:~# apache2ctl -S
VirtualHost configuration:
*:80                   freeipa.seaproject-test.ru (/etc/apache2/sites-enabled/000-default.conf:1)
ServerRoot: "/etc/apache2"
Main DocumentRoot: "/var/www/html"
Main ErrorLog: "/var/log/apache2/error.log"
Mutex ssl-stapling: using_defaults
Mutex proxy: using_defaults
Mutex ssl-cache: using_defaults
Mutex default: dir="/var/run/apache2/" mechanism=default
Mutex mpm-accept: using_defaults
Mutex watchdog-callback: using_defaults
Mutex rewrite-map: using_defaults
Mutex ssl-stapling-refresh: using_defaults
PidFile: "/var/run/apache2/apache2.pid"
Define: DUMP_VHOSTS
Define: DUMP_RUN_CFG
User: name="www-data" id=33
Group: name="www-data" id=33


<VirtualHost *:443>
    ServerName freeipa.seaproject-test.ru

    SSLEngine on
    SSLCertificateFile /var/lib/ipa/certs/httpd.pem
    SSLCertificateKeyFile /var/lib/ipa/private/httpd.key
    SSLCertificateChainFile /var/lib/ipa/certs/ca.crt

    DocumentRoot /var/www/html

    ErrorLog ${APACHE_LOG_DIR}/error.log
    CustomLog ${APACHE_LOG_DIR}/access.log combined

    <Directory /var/www/html>
        Options FollowSymLinks
        AllowOverride None
        Require all granted
    </Directory>
</VirtualHost>



root@freeipa:~# nano /etc/apache2/sites-available/
000-default.conf  default-ssl.conf
root@freeipa:~# nano /etc/apache2/sites-available/freeipa-ssl.conf
root@freeipa:~# cat /var/lib/ipa/
backup/     certs/      dnssec/     gssproxy/   passwds/    pki-ca/     private/    sysrestore/ sysupgrade/
root@freeipa:~# cat /var/lib/ipa/certs/
cacert.pem  httpd.crt   kdc.crt     kdc.key
root@freeipa:~# cat /var/lib/ipa/certs/^C
root@freeipa:~# a2en
a2enconf  a2enmod   a2ensite
root@freeipa:~# a2ensite freeipa-ssl.conf
Enabling site freeipa-ssl.
To activate the new configuration, you need to run:
  systemctl reload apache2
root@freeipa:~# systemctl reload apache2
Job for apache2.service failed.
See "systemctl status apache2.service" and "journalctl -xeu apache2.service" for details.
root@freeipa:~# apache2ctl -S
VirtualHost configuration:
*:80                   freeipa.seaproject-test.ru (/etc/apache2/sites-enabled/000-default.conf:1)
*:443                  freeipa.seaproject-test.ru (/etc/apache2/sites-enabled/freeipa-ssl.conf:1)
ServerRoot: "/etc/apache2"
Main DocumentRoot: "/var/www/html"
Main ErrorLog: "/var/log/apache2/error.log"
Mutex ssl-stapling: using_defaults
Mutex proxy: using_defaults
Mutex ssl-cache: using_defaults
Mutex default: dir="/var/run/apache2/" mechanism=default
Mutex mpm-accept: using_defaults
Mutex watchdog-callback: using_defaults
Mutex rewrite-map: using_defaults
Mutex ssl-stapling-refresh: using_defaults
PidFile: "/var/run/apache2/apache2.pid"
Define: DUMP_VHOSTS
Define: DUMP_RUN_CFG
User: name="www-data" id=33
Group: name="www-data" id=33
root@freeipa:~# cat /etc/apache2/sites-available/
000-default.conf  default-ssl.conf  freeipa-ssl.conf
root@freeipa:~# cat /etc/apache2/sites-available/000-default.conf
<VirtualHost *:80>
    ServerName freeipa.seaproject-test.ru
    DocumentRoot /var/www/html
</VirtualHost>
root@freeipa:~#


Done configuring certificate server (pki-tomcatd).
Configuring directory server (dirsrv)
  [1/3]: configuring TLS for DS instance
  [error] CalledProcessError: CalledProcessError(Command ['/usr/bin/certutil', '-d', 'sql:/etc/dirsrv/slapd-SEAPROJECT-TEST-RU/', '-A', '-n', 'SEAPROJECT-TEST.RU IPA CA', '-t', 'CT,C,C', '-a', '-f', '/etc/dirsrv/slapd-SEAPROJECT-TEST-RU/pwdfile.txt'] returned non-zero exit status 255: 'certutil: could not decode certificate: SEC_ERROR_REUSED_ISSUER_AND_SERIAL: You are attempting to import a cert with the same issuer/serial as an existing cert, but that is not the same cert.\n')
CalledProcessError(Command ['/usr/bin/certutil', '-d', 'sql:/etc/dirsrv/slapd-SEAPROJECT-TEST-RU/', '-A', '-n', 'SEAPROJECT-TEST.RU IPA CA', '-t', 'CT,C,C', '-a', '-f', '/etc/dirsrv/slapd-SEAPROJECT-TEST-RU/pwdfile.txt'] returned non-zero exit status 255: 'certutil: could not decode certificate: SEC_ERROR_REUSED_ISSUER_AND_SERIAL: You are attempting to import a cert with the same issuer/serial as an existing cert, but that is not the same cert.\n')
The ipa-server-install command failed. See /var/log/ipaserver-install.log for more information




