stages:
  - build

build_job:
  stage: build
  script:
    - |
      echo "Оригинальный путь проекта: $CI_PROJECT_PATH"

      # Разбиваем путь на части
      IFS='/' read -r -a PARTS <<< "$CI_PROJECT_PATH"

      # Ищем индекс "deploy"
      for i in "${!PARTS[@]}"; do
        if [[ "${PARTS[$i]}" == "deploy" ]]; then
          DEPLOY_INDEX=$i
          break
        fi
      done

      # Проверка: нашли ли "deploy"
      if [ -z "$DEPLOY_INDEX" ]; then
        echo "Ошибка: в пути не найден 'deploy'"
        exit 1
      fi

      # Собираем элементы до "deploy" в одну строку через "_"
      TARGET_PARTS=("${PARTS[@]:0:$DEPLOY_INDEX}")
      DIR_NAME=$(IFS=_ ; echo "${TARGET_PARTS[*]}")

      echo "Создаём каталог: $DIR_NAME"
      mkdir -p "$DIR_NAME"
